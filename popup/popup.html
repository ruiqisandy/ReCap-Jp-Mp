<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI-ReCap</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">

    <!-- SCREEN 1: WELCOME SCREEN -->
    <div id="welcomeScreen" class="screen">
      <header class="welcome-header">
        <div class="logo">
          <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
            <circle cx="24" cy="24" r="20" stroke="currentColor" stroke-width="3"/>
            <path d="M15 24L21 30L33 18" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <h1>AI-ReCap</h1>
        <p class="tagline">Your AI Knowledge Hub</p>
      </header>

      <main class="welcome-main">
        <h2>Let's turn your chat history into a personal knowledge base</h2>

        <div class="ai-status-card">
          <div class="ai-status-indicator">
            <span class="status-dot" id="welcomeAiStatusDot"></span>
            <span class="status-text" id="welcomeAiStatus">Checking AI...</span>
          </div>
          <p class="ai-status-hint">Chrome's Built-in AI will analyze and organize your chats</p>
        </div>

        <button id="startImportBtn" class="btn btn-primary btn-large">
          <svg class="btn-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M10 3V17M10 17L5 12M10 17L15 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Import & Analyze All Chats
        </button>

        <button id="viewLibraryFromWelcomeBtn" class="btn-link" style="margin-top: 12px; display: none;">
          View My Library →
        </button>

        <p class="hint-text">We'll automatically detect your conversations from supported sites</p>
      </main>

      <footer class="welcome-footer">
        <p class="supported-platforms">Supports: ChatGPT • Claude • Gemini</p>
      </footer>
    </div>

    <!-- SCREEN 2: PROGRESS SCREEN -->
    <div id="progressScreen" class="screen" style="display: none;">
      <header class="progress-header">
        <button id="backToWelcomeBtn" class="btn-icon-only" style="position: absolute; left: 16px;">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
            <path d="M12.5 15L7.5 10L12.5 5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <h1>Importing Conversations</h1>
        <p class="subtitle">Please keep this popup open</p>
      </header>

      <main class="progress-main">
        <div class="platform-stats">
          <div class="platform-stat">
            <div class="platform-icon chatgpt">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <circle cx="12" cy="12" r="10"/>
              </svg>
            </div>
            <div class="platform-info">
              <span class="platform-name">ChatGPT</span>
              <span class="platform-count" id="chatgptCount">0</span>
            </div>
          </div>

          <div class="platform-stat">
            <div class="platform-icon claude">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <circle cx="12" cy="12" r="10"/>
              </svg>
            </div>
            <div class="platform-info">
              <span class="platform-name">Claude</span>
              <span class="platform-count" id="claudeCount">0</span>
            </div>
          </div>

          <div class="platform-stat">
            <div class="platform-icon gemini">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <circle cx="12" cy="12" r="10"/>
              </svg>
            </div>
            <div class="platform-info">
              <span class="platform-name">Gemini</span>
              <span class="platform-count" id="geminiCount">0</span>
            </div>
          </div>
        </div>

        <div class="progress-section">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <p class="status-text" id="statusText">Initializing...</p>
        </div>

        <button id="viewLibraryBtn" class="btn btn-primary btn-large" style="display: none;">
          View Your Library
        </button>
      </main>
    </div>

    <!-- SCREEN 3: LIBRARY SCREEN -->
    <div id="libraryScreen" class="screen" style="display: none;">
      <header class="library-header">
        <button id="backToWelcomeFromLibraryBtn" class="btn-icon-only" style="margin-right: auto;">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
            <path d="M12.5 15L7.5 10L12.5 5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <h1>Your Knowledge Hub</h1>
        <button id="refreshBtn" class="btn-icon-only">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
            <path d="M17.5 10C17.5 14.1421 14.1421 17.5 10 17.5C5.85786 17.5 2.5 14.1421 2.5 10C2.5 5.85786 5.85786 2.5 10 2.5C12.5 2.5 14.5 4 15.5 6M15.5 2.5V6H12" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </header>

      <main class="library-main">
        <!-- AI Processing Section -->
        <section class="library-section" id="aiProcessingSection" style="display: none;">
          <div class="ai-processing-card">
            <div class="ai-processing-header">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="color: #10a37f;">
                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <div>
                <h3>AI-Powered Analysis</h3>
                <p>Generate summaries and label suggestions from your conversations</p>
              </div>
            </div>
            <button id="processAIBtn" class="btn btn-primary">
              <svg class="btn-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                <path d="M10 6V10L13 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Process with AI
            </button>
            <div id="aiProcessingProgress" style="display: none;">
              <div class="progress-bar" style="margin-top: 12px;">
                <div class="progress-fill" id="aiProgressFill"></div>
              </div>
              <p class="status-text" id="aiStatusText" style="margin-top: 8px; font-size: 13px;">Processing...</p>
            </div>
          </div>
        </section>
        <!-- Suggested Labels Section -->
        <section class="library-section">
          <div class="section-header">
            <h2>Suggested Labels</h2>
            <span class="badge" id="suggestedBadge">0</span>
          </div>
          <div class="list-container" id="suggestedList">
            <div class="empty-state">
              <p>No suggestions yet. Import chats and run AI processing to get started.</p>
            </div>
          </div>
        </section>

        <!-- Your Library Section -->
        <section class="library-section">
          <div class="section-header">
            <h2>Your Library</h2>
            <button id="createLabelBtn" class="btn btn-small">
              <svg class="btn-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor">
                <path d="M8 3V13M3 8H13" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Create New
            </button>
          </div>
          <div class="list-container" id="labelList">
            <div class="empty-state">
              <p>Your curated labels will appear here.</p>
            </div>
          </div>
        </section>

        <!-- All Conversations Section (NEW) -->
        <section class="library-section">
          <div class="section-header">
            <h2>All Conversations</h2>
            <span class="badge" id="allChatsBadge">0</span>
          </div>

          <!-- Platform Filters -->
          <div class="filter-buttons">
            <button class="filter-btn active" data-platform="all">All</button>
            <button class="filter-btn" data-platform="chatgpt">
              <span class="platform-dot chatgpt"></span>
              ChatGPT
            </button>
            <button class="filter-btn" data-platform="claude">
              <span class="platform-dot claude"></span>
              Claude
            </button>
            <button class="filter-btn" data-platform="gemini">
              <span class="platform-dot gemini"></span>
              Gemini
            </button>
          </div>

          <!-- Chat List Container -->
          <div class="list-container" id="chatList">
            <div class="empty-state">
              <p>No conversations yet. Import chats to see them here.</p>
            </div>
          </div>
        </section>
      </main>

      <footer class="library-footer">
        <button id="settingsBtn" class="btn-link">Settings</button>
        <button id="clearDataBtn" class="btn-link text-danger">Clear All Data</button>
      </footer>
    </div>

  </div>

  <script src="../lib/ai-service.js"></script>
  <script src="popup.js"></script>
</body>
</html>
