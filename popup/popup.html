<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI-ReCap</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">

    <!-- SCREEN 1: WELCOME SCREEN -->
    <div id="welcomeScreen" class="screen">
      <header class="welcome-header">
        <div class="logo">
          <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
            <circle cx="24" cy="24" r="20" stroke="currentColor" stroke-width="3"/>
            <path d="M15 24L21 30L33 18" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <h1>AI-ReCap</h1>
        <p class="tagline">Your AI Knowledge Hub</p>
      </header>

      <main class="welcome-main">
        <h2>Let's turn your chat history into a personal knowledge base</h2>

        <div class="ai-status-card">
          <div class="ai-status-indicator">
            <span class="status-dot" id="welcomeAiStatusDot"></span>
            <span class="status-text" id="welcomeAiStatus">Checking AI...</span>
          </div>
          <p class="ai-status-hint">Chrome's Built-in AI will analyze and organize your chats</p>
        </div>

        <button id="startImportBtn" class="btn btn-primary btn-large">
          <svg class="btn-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M10 3V17M10 17L5 12M10 17L15 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Import & Analyze All Chats
        </button>

        <button id="viewLibraryFromWelcomeBtn" class="btn-link" style="margin-top: 12px; display: none;">
          View My Library →
        </button>

        <p class="hint-text">We'll automatically detect your conversations from supported sites</p>
      </main>

      <footer class="welcome-footer">
        <p class="supported-platforms">Supports: ChatGPT • Claude • Gemini</p>
      </footer>
    </div>

    <!-- SCREEN 2: PROGRESS SCREEN -->
    <div id="progressScreen" class="screen" style="display: none;">
      <header class="progress-header">
        <button id="backToWelcomeBtn" class="btn-icon-only" style="position: absolute; left: 16px;">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
            <path d="M12.5 15L7.5 10L12.5 5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <h1>Importing Conversations</h1>
        <p class="subtitle">Please keep this popup open</p>
      </header>

      <main class="progress-main">
        <div class="platform-stats">
          <div class="platform-stat">
            <div class="platform-icon chatgpt">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <circle cx="12" cy="12" r="10"/>
              </svg>
            </div>
            <div class="platform-info">
              <span class="platform-name">ChatGPT</span>
              <span class="platform-count" id="chatgptCount">0</span>
            </div>
          </div>

          <div class="platform-stat">
            <div class="platform-icon claude">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <circle cx="12" cy="12" r="10"/>
              </svg>
            </div>
            <div class="platform-info">
              <span class="platform-name">Claude</span>
              <span class="platform-count" id="claudeCount">0</span>
            </div>
          </div>

          <div class="platform-stat">
            <div class="platform-icon gemini">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <circle cx="12" cy="12" r="10"/>
              </svg>
            </div>
            <div class="platform-info">
              <span class="platform-name">Gemini</span>
              <span class="platform-count" id="geminiCount">0</span>
            </div>
          </div>
        </div>

        <div class="progress-section">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <p class="status-text" id="statusText">Initializing...</p>
        </div>

        <button id="viewLibraryBtn" class="btn btn-primary btn-large" style="display: none;">
          View Your Library
        </button>
      </main>
    </div>

    <!-- SCREEN 3: LIBRARY SCREEN -->
    <div id="libraryScreen" class="screen" style="display: none;">
      <header class="library-header">
        <button id="backToWelcomeFromLibraryBtn" class="btn-icon-only" style="margin-right: auto;">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
            <path d="M12.5 15L7.5 10L12.5 5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <h1>Your Knowledge Hub</h1>
        <button id="refreshBtn" class="btn-icon-only">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
            <path d="M17.5 10C17.5 14.1421 14.1421 17.5 10 17.5C5.85786 17.5 2.5 14.1421 2.5 10C2.5 5.85786 5.85786 2.5 10 2.5C12.5 2.5 14.5 4 15.5 6M15.5 2.5V6H12" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </header>

      <main class="library-main">
        <!-- Summarize Chats CTA -->
        <section class="library-mini-section" id="summarizationSection" style="display: none;">
          <div class="mini-card">
            <div class="mini-card-info">
              <h3>Summarize Conversations</h3>
              <p>Generate chat summaries so labels stay accurate.</p>
            </div>
            <button id="summarizeBtn" class="btn btn-primary btn-small">
              <svg class="btn-icon" width="18" height="18" viewBox="0 0 20 20" fill="none">
                <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                <path d="M10 6V10L13 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Summarize Chats
            </button>
          </div>
          <div id="summarizationProgress" class="mini-progress" style="display: none;">
            <div class="progress-bar">
              <div class="progress-fill" id="summarizeProgressFill"></div>
            </div>
            <p class="status-text" id="summarizeStatusText">Processing...</p>
          </div>
        </section>
        <!-- Your Library Section -->
        <section class="library-section">
          <div class="section-header">
            <h2>Your Library</h2>
            <div style="display: flex; align-items: center; gap: 8px;">
              <button id="createLabelBtn" class="btn btn-small">
                <svg class="btn-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor">
                  <path d="M8 3V13M3 8H13" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Create New
              </button>
              <button id="clearAcceptedBtn" class="btn btn-small" style="display: none; background: #ef4444; color: white;">
                <svg class="btn-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor">
                  <path d="M1 3.5h12M5.5 1h3M5.5 13h3M5.5 5.5v5M8.5 5.5v5" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                Clear All
              </button>
            </div>
          </div>
          <div class="list-container" id="labelList">
            <div class="empty-state">
              <p>Your curated labels will appear here.</p>
            </div>
          </div>
        </section>

        <!-- All Conversations Section (NEW) -->
        <section class="library-section">
          <div class="section-header">
            <h2>All Conversations</h2>
            <span class="badge" id="allChatsBadge">0</span>
          </div>

          <!-- Platform Filters -->
          <div class="filter-buttons">
            <button class="filter-btn active" data-platform="all">All</button>
            <button class="filter-btn" data-platform="chatgpt">
              <span class="platform-dot chatgpt"></span>
              ChatGPT
            </button>
            <button class="filter-btn" data-platform="claude">
              <span class="platform-dot claude"></span>
              Claude
            </button>
            <button class="filter-btn" data-platform="gemini">
              <span class="platform-dot gemini"></span>
              Gemini
            </button>
          </div>

          <!-- Chat List Container -->
          <div class="list-container" id="chatList">
            <div class="empty-state">
              <p>No conversations yet. Import chats to see them here.</p>
            </div>
          </div>
        </section>
      </main>

      <footer class="library-footer">
        <button id="settingsBtn" class="btn-link">Settings</button>
        <button id="clearDataBtn" class="btn-link text-danger">Clear All Data</button>
      </footer>
    </div>

    <!-- SCREEN 4: LABEL WORKFLOW -->
    <div id="labelWorkflowScreen" class="screen" style="display: none;">
      <header class="workflow-header">
        <button id="backToLibraryFromWorkflowBtn" class="btn-icon-only" title="Back to Library">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
            <path d="M12.5 15L7.5 10L12.5 5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <div class="workflow-titles">
          <h1>Organize Your Chats</h1>
          <p>Pick preferred labels or let the AI suggest new categories.</p>
        </div>
      </header>

      <main class="workflow-main">
        <!-- Preferred Labels Section -->
        <section class="workflow-section" id="preferredLabelsSection">
          <div class="workflow-card">
            <div class="workflow-card-header">
              <h3>Preferred Labels</h3>
              <p>Tell us the topics you care about. Chats will be grouped only into these labels.</p>
            </div>
            <div class="preferred-labels-wrapper">
              <div class="preferred-labels-controls header">
                <button id="addPreferredLabelBtn" class="btn btn-small" type="button">
                  <svg class="btn-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor">
                    <path d="M7 2v10M2 7h10" stroke-width="1.5" stroke-linecap="round"/>
                  </svg>
                  Add Preferred Label
                </button>
              </div>
              <div class="preferred-labels-list" id="preferredLabelsList">
                <div class="preferred-labels-empty">
                  <p>Add the topics you care about to get tailored label suggestions.</p>
                </div>
              </div>
            </div>
            <div class="preferred-labels-footer compact">
              <span id="preferredLabelsStatus" class="preferred-labels-status">Add up to six labels or skip to auto-categorize.</span>
              <div class="preferred-labels-actions">
                <button id="savePreferredLabelsBtn" class="btn btn-primary" type="button">
                  <svg class="btn-icon" width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor">
                    <path d="M15 5l-7.5 7L3 7.5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Save &amp; Classify
                </button>
                <button id="continueWithoutPreferencesBtn" class="btn btn-secondary" type="button">
                  Continue Without Preferences
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- Classification Status Section -->
        <section class="workflow-section" id="labelGenerationSection">
          <div class="workflow-card highlight">
            <div id="labelGenerationProgress" class="workflow-progress" style="display: none;">
              <div class="progress-bar">
                <div class="progress-fill" id="labelProgressFill"></div>
              </div>
              <p class="status-text" id="labelStatusText">Preparing...</p>
            </div>
            <p class="workflow-hint">We’ll automatically group chats as soon as you save or skip.</p>
          </div>
        </section>

        <!-- Suggested Labels (Workflow) -->
        <section class="workflow-section">
          <div class="workflow-card">
            <div class="workflow-card-header">
              <h3>Suggested Labels</h3>
              <p>Review AI suggestions and add the ones that look right.</p>
            </div>
            <div class="workflow-suggestions-toolbar">
              <span class="badge" id="suggestedBadge">0</span>
              <button id="clearSuggestedBtn" class="btn btn-small" style="display: none; background: #ef4444; color: white;">
                <svg class="btn-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor">
                  <path d="M1 3.5h12M5.5 1h3M5.5 13h3M5.5 5.5v5M8.5 5.5v5" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                Clear All
              </button>
            </div>
            <div class="list-container" id="suggestedList">
              <div class="empty-state">
                <p>No suggestions yet. Save preferences or skip to auto-generate them.</p>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- SCREEN 5: LABEL VIEW SCREEN -->
    <div id="labelScreen" class="screen" style="display: none;">
      <header class="label-header">
        <button id="backToLibraryBtn" class="btn-icon-only">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
            <path d="M12.5 15L7.5 10L12.5 5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <div class="label-header-content">
          <h1 id="labelViewName">Label Name</h1>
          <span class="badge" id="labelViewChatCount">0 chats</span>
        </div>
      </header>

      <main class="label-main">
        <!-- Tab Navigation -->
        <div class="tab-nav">
          <button class="tab-button active" data-tab="summary">Summary</button>
          <button class="tab-button" data-tab="chatlist">Chat List</button>
          <button class="tab-button" data-tab="mindmap">Mind Map</button>
          <button class="tab-button" data-tab="bulletpoints">Bullet Points</button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
          <!-- Summary Tab (Default) -->
          <div id="summaryTab" class="tab-panel active">
            <div id="summaryContent" class="summary-content">
              <p class="summary-placeholder">Click "Generate Summary" to create an aggregated summary from all conversations in this label.</p>
            </div>
            <div class="summary-actions">
              <button id="generateSummaryBtn" class="btn btn-primary btn-small">
                <svg class="btn-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor">
                  <path d="M7 1v12M1 7h12" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Generate Summary
              </button>
            </div>
          </div>

          <!-- Chat List Tab -->
          <div id="chatlistTab" class="tab-panel">
            <div class="chatlist-content">
              <div class="chatlist-filters">
                <button class="filter-btn active" data-platform="all">All</button>
                <button class="filter-btn" data-platform="chatgpt">
                  <span class="platform-dot chatgpt"></span>
                  ChatGPT
                </button>
                <button class="filter-btn" data-platform="claude">
                  <span class="platform-dot claude"></span>
                  Claude
                </button>
                <button class="filter-btn" data-platform="gemini">
                  <span class="platform-dot gemini"></span>
                  Gemini
                </button>
              </div>
              <div class="chatlist-items" id="labelChatList">
                <div class="empty-state">
                  <p>No conversations in this label.</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Mind Map Tab (Placeholder) -->
          <div id="mindmapTab" class="tab-panel">
            <div class="placeholder-tab">
              <svg width="64" height="64" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="32" cy="32" r="10"/>
                <circle cx="12" cy="16" r="6"/>
                <circle cx="52" cy="16" r="6"/>
                <circle cx="12" cy="48" r="6"/>
                <circle cx="52" cy="48" r="6"/>
                <path d="M22 28L18 22M42 28L46 22M22 36L18 42M42 36L46 42"/>
              </svg>
              <h3>Mind Map Visualization</h3>
              <p>Coming soon! Visual representation of topics and concepts from your conversations.</p>
            </div>
          </div>

          <!-- Bullet Points Tab -->
          <div id="bulletpointsTab" class="tab-panel">
            <div id="bulletpointsContent" class="bulletpoints-content">
              <p class="bulletpoints-placeholder">Click "Generate Bullet Points" to create a structured mindmap-style summary from all conversations in this label.</p>
            </div>
            <div class="bulletpoints-actions">
              <button id="generateBulletPointsBtn" class="btn btn-primary btn-small">
                <svg class="btn-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor">
                  <circle cx="4" cy="2" r="1.5" fill="currentColor" stroke="none"/>
                  <circle cx="4" cy="7" r="1.5" fill="currentColor" stroke="none"/>
                  <circle cx="4" cy="12" r="1.5" fill="currentColor" stroke="none"/>
                  <path d="M7 2h6M7 7h6M7 12h6" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                Generate Bullet Points
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>

  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script src="../lib/storage.js"></script>
  <script src="../lib/ai-service.js"></script>
  <script src="popup.js"></script>
</body>
</html>
